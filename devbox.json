{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    "nodejs@latest",
    "github:NixOS/nixpkgs/7cc0bff31a3a705d3ac4fdceb030a17239412210#elixir",
    "postgresql@latest",
    "pre-commit@4.3.0"
  ],
  "env": {
    "ERL_AFLAGS": "-kernel shell_history enabled"
  },
  "env_from": ".env",
  "shell": {
    "scripts": {
      "init_hook": "pre-commit install --hook-type commit-msg",
      "initdb": "initdb",
      "create-db-user": "psql -c \"CREATE USER ${POSTGRES_USER} WITH SUPERUSER CREATEDB PASSWORD '${POSTGRES_PASSWORD}';\" postgres",
      "deploy": [
        "git pull",
        "mix deps.get",
        "mix npmdeps.get",
        "MIX_ENV=prod mix compile",
        "PGHOST= PGDATA= MIX_ENV=prod mix ecto.migrate",
        "MIX_ENV=prod mix phx.gen.release",
        "MIX_ENV=prod mix release",
        "rsync --archive --itemize-changes --delete _build /srv/webapps/fixxon/"
      ]
    }
  }
}